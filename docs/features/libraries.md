# ライブラリシステム

プラグインでは、よく使用される関数やユーティリティをライブラリとして提供する機能があります。ライブラリを使用することで、コードの再利用性を高め、開発効率を向上させることができます。

## 概要

ライブラリシステムは以下の特徴を持ちます：

- **自動読み込み**: プラグイン起動時に自動的にライブラリが読み込まれます
- **標準ライブラリ**: プラグインには標準ライブラリが組み込まれています
- **カスタムライブラリ**: ユーザー独自のライブラリを追加できます
- **関数として利用**: ライブラリ内の関数は通常の関数と同様に呼び出せます

## ライブラリの配置場所

ライブラリファイルは以下の場所に配置されます：

```
plugins/CakeLang/libs/
```

このディレクトリは初回起動時に自動的に作成されます。

## ライブラリファイルの形式

### ファイル拡張子
ライブラリファイルは `.func` 拡張子を持つ必要があります。

例：`myLibrary.func`

### ファイル内容
ライブラリファイルの内容は、通常の関数定義と同じ形式で記述します：

```
# ライブラリ内の関数例
cmd say Hello from library!
cmd say Library function executed
```

### 2. ライブラリの作成と使用

#### Step 1: ライブラリファイルの作成
`plugins/CakeLang/libs/myUtils.func` を作成：

```
# myUtils.func の内容例
cmd say ユーティリティ関数が実行されました
setvarG lastUtilExecution <unixtime>
```

#### Step 2: プラグインの再起動
ライブラリファイルを配置した後、プラグインを再起動します。

#### Step 3: ライブラリ関数の呼び出し
```
# カスタムライブラリの関数を呼び出し
/cakelang myUtils
```

## ライブラリの動作仕組み

### 初期化プロセス
1. **ディレクトリ作成**: `libs` ディレクトリが存在しない場合は自動作成
2. **標準ライブラリのコピー**: 組み込み標準ライブラリをファイルシステムにコピー
3. **ファイル検索**: `libs` ディレクトリ内の `.func` ファイルを検索
4. **関数登録**: 各ライブラリファイルの内容を関数として登録

### 関数名の決定
ライブラリファイル名（拡張子を除く）が関数名になります：

- `myLibrary.func` → 関数名：`myLibrary`
- `utils.func` → 関数名：`utils`
- `helper.func` → 関数名：`helper`

## 実用的な使用例

### ログ出力ライブラリ
```
# logger.func
cmd say [LOG] <args.0>
setvarG lastLogMessage <args.0>
setvarG lastLogTime <unixtime>
```

使用方法：
```
# ログ出力ライブラリの使用
logger "システムが正常に起動しました"
```

### 計算ユーティリティライブラリ
```
# mathUtils.func
setvar result <args.0+args.1>
setvarG mathResult <result>
cmd say 計算結果: <result>
```

使用方法：
```
# 数値計算ライブラリの使用
mathUtils 10 20
cmd say 最後の計算結果: <mathResult>
```

### プレイヤー管理ライブラリ
```
# playerManager.func
players allPlayers
length playerCount allPlayers
cmd say 現在のプレイヤー数: <playerCount>
setvarG currentPlayerCount <playerCount>
```

使用方法：
```
# プレイヤー管理ライブラリの使用
playerManager
```

## 注意事項

### ファイル名の制約
- ファイル名は英数字とアンダースコア（_）を推奨
- 日本語などのマルチバイト文字は避ける
- 拡張子は必ず `.func` にする

### 関数名の競合
- 既存の関数名と同じ名前のライブラリは作成しない
- ライブラリ間で同じファイル名を使用しない

### パフォーマンス
- ライブラリは起動時に一度だけ読み込まれる
- 大量のライブラリは起動時間に影響する可能性がある

### エラーハンドリング
- ライブラリファイルが読み込めない場合、警告がログに出力される
- 構文エラーのあるライブラリは読み込まれない

## トラブルシューティング

### ライブラリが読み込まれない場合
1. ファイル拡張子が `.func` になっているか確認
2. ファイルがUTF-8エンコーディングで保存されているか確認
3. プラグインを再起動したか確認
4. サーバーログでエラーメッセージを確認

### 関数が呼び出せない場合
1. ライブラリが正常に読み込まれているかログで確認
2. 関数名がファイル名と一致しているか確認
3. 構文エラーがないか確認

## 高度な活用方法

### ライブラリの組み合わせ
```
# composite.func - 複数のライブラリを組み合わせた例
logger "複合処理を開始します"
mathUtils <args.0> <args.1>
playerManager
logger "複合処理が完了しました"
```

### 条件付きライブラリ実行
```
# conditional.func - 条件に応じてライブラリを実行
if <args.0=debug> logger else playerManager
```

## まとめ

ライブラリシステムを活用することで：
- コードの再利用性が向上
- 保守性が向上
- 開発効率が向上
- システム全体の一貫性が保たれる

効果的なライブラリを作成して、より効率的なMinecraftプラグイン開発を行いましょう。